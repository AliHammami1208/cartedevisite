name : Newman API Tests

on:
 push: 
   branches: ["main"]

jobs:
  run-api-tests:
    runs-on: ubuntu-latest


    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: installation de node js
        uses: actions/setup-node@v4
        with :
          node-version: "18"
      
      - name: installation librairie
        run: npm install

      - name: lancement de server
        run: |
          nohup node server.js > server.log 2>&1 &
          sleep 5
      
      - name: installation de newman + html extra reporter
        run: npm install -g newman newman-reporter-htmlextra 

      - name: lancement newman
        run: |
          newman run "./postman/collection.postman_collection.json" \
          -e "/postman/environnement.postman_environnement.json" \
          --iteration-data "/postman/iteration.json"
